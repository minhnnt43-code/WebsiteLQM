import { kv } from '@vercel/kv';

const DATA_KEY = 'minhWebsiteData_VercelKV';

export default async function handler(request, response) {
    try {
        if (request.method === 'GET') {
            let data = await kv.get(DATA_KEY);
            if (!data) {
                // Dữ liệu mẫu nếu chưa có gì
                data = {
                    achievements: [
                        {id: Date.now() + 1, title: 'Chiến sĩ hoàn thành xuất sắc nhiệm vụ Chiến dịch Mùa hè xanh 2025', description: 'Được khen thưởng vì đã hoàn thành xuất sắc các nhiệm vụ được giao.', imageId: '12-wT41fQ47KypmgXKvSAi7PjA8MvWnUv'},
                        {id: Date.now() + 2, title: 'Học bổng Khuyến khích học tập', description: 'Nhận học bổng từ nhà trường cho những nỗ lực và cống hiến trong học tập.', imageId: '1eM9Y-gNusx5aT6MvMv4-0aY_iO7bIq_W'}
                    ],
                    messages: [
                        {id: Date.now() + 3, name: 'Một người bạn', text: 'Chúc Minh luôn thành công trên con đường đã chọn nhé!'}
                    ]
                };
            }
            return response.status(200).json(data);
        }

        if (request.method === 'POST') {
            const newData = request.body;
            // Validate data before saving (important for security)
            if (!newData || !Array.isArray(newData.achievements) || !Array.isArray(newData.messages)) {
                 return response.status(400).json({ error: 'Dữ liệu không hợp lệ.' });
            }
            await kv.set(DATA_KEY, newData);
            return response.status(200).json({ message: 'Lưu dữ liệu thành công' });
        }
        
        return response.status(405).json({ error: 'Phương thức không được phép.' });

    } catch (error) {
        console.error('API Lỗi:', error);
        return response.status(500).json({ error: 'Lỗi máy chủ nội bộ' });
    }
}
